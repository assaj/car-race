<!DOCTYPE html>
<html>
<head>
	<title>CAR RACE</title>
</head>
<body>
	<button onclick="newPlayer()">Create a new player</button>
	<button onclick="gameReset()">Reset</button>
<canvas id="stage" width="600" height="600"></canvas>
<script type="text/javascript">

var time = 500, sqrtSize = 10, ctx, stage,numberOfPlayers = 1, colisorNumber;
var px = [],py = [], alive = [], setOfColors = ["","red","blue","black","white","pink"], lastYPosition;
window.onload = function(){
	stage = document.getElementById('stage');
	ctx = stage.getContext("2d");

	ctx.fillStyle = "grey";
	ctx.fillRect(0,0, stage.width, stage.height);
	newPlayer();
	
}

setInterval(run,time);

function run(){
	
	ctx.fillStyle = "grey";
    ctx.fillRect(0,0, stage.width, stage.height);

	ctx.fillStyle = "yellow";
	ctx.fillRect(100,100,400,400);

	ctx.fillStyle = "green";
	ctx.fillRect(0,480,100,20);

	for(var x = 1; x < numberOfPlayers; x++){
			randomMove(x);
			killPlayer(x);
	}	

	for(var x = 1; x <= numberOfPlayers; x++){
		if(alive[x]){
		ctx.fillStyle = setOfColors[x];
		ctx.fillRect(px[x],py[x],20,20);//X,Y,WIDTH,HEIGHT
		}
	}
}

function playerMovement(
	movement, playerNumber) {
		lastYPosition = py[playerNumber];
	switch(movement){
		case "r":
			px[playerNumber]+=20;
		break;
		case "l":
			px[playerNumber]-=20;
		break;
		case "u":
			py[playerNumber]-=20;
		break;
		case "d":
			py[playerNumber]+=20;
		break;
	}
}

function newPlayer(){
	if(numberOfPlayers > 5){
		alert("The max number of player is 5.");
	}else{
		px[numberOfPlayers] = (numberOfPlayers-1) * 20;
		py[numberOfPlayers] = 460;
		alive[numberOfPlayers] = true;
		numberOfPlayers++;
	}
}

function gameReset(){
	let gameOn = false;
	for(var i = 1; i < numberOfPlayers ; i++){
		console.log(i);
		if(alive[i]){
		 	gameOn = true;
		}
	}
	if(!gameOn){
		console.log("r");
		for(var x = 1; x < numberOfPlayers ; x++){
			console.log("aa: ");
			px[x] = (x-1) * 20;
			py[x] = 460;
			alive[x] = true;
		}
	}
}

function killPlayer(playerNumber){
	if(px[playerNumber] >= 100 && py[playerNumber] >= 100 && py[playerNumber] < 500 && px[playerNumber] < 500){
		alive[playerNumber] = false;
	}

	if(inColision(playerNumber)){
		alive[colisorNumber] = false;
		alive[playerNumber] = false;
	}

	if(foul(playerNumber)){
		alive[playerNumber] = false;
	}

	if(px[playerNumber] < 0 || px[playerNumber] > 500 || py[playerNumber] < 0 || py[playerNumber] > 500){
		alive[playerNumber] = false;
	}
}

function foul(playerNumber){

	if(lastYPosition == 460 && py[playerNumber] == 480 && px[playerNumber] < 200){
		return true;
	}else{
		return false;
	}

}

function inColision(playerNumber){

	for(var x = 1; x <= numberOfPlayers; x++){
		if(x != playerNumber){
			if(px[x] == px[playerNumber] && py[x] == py[playerNumber]){
				colisorNumber = x;
				return true;
			}
		}
	}
	return false;
}

function randomMove(playerNumber){
	let x = Math.floor((Math.random() * 4) + 1);

	switch(x){
		case 1:
			playerMovement("r",playerNumber);
		break;
		case 2:
			playerMovement("l",playerNumber);
		break;
		case 3:
			playerMovement("u",playerNumber);
		break;
		case 4:
			playerMovement("u",playerNumber);
		break;
	}
}

</script>
</body>
</html>

